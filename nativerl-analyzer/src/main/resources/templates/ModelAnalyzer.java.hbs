{{#if packageName}}package {{packageName}};{{/if}}
import com.anylogic.engine.Engine;
import pathmind.policyhelper.PathmindHelper;

import java.util.*;
import java.util.stream.*;

public class ModelAnalyzer {
    private static String display(String[] theStrings) {
        return Stream.of(theStrings).collect(Collectors.joining("|"));
    }
    public static void main(String[] args) throws Throwable {
        List<String> failedSteps = new ArrayList<>();

        Engine engine = new Training(null).createEngine();
        Simulation sim = new Simulation();
        sim.setupEngine(engine);
        sim.initDefaultRandomNumberGenerator(engine);

        // Create new agent object:
        {{agentClassName}} agent;
        try {
          agent = new {{agentClassName}}(engine, null, null);
        }
        catch(RuntimeException e) {
            String message = e.getMessage();
            if (e != null) {
                if (message.contains("Could not find local class in class")) {
                    System.out.println("oldVersionFound:true");
                    System.exit(0);
                    return;
                }
            }
            e.printStackTrace(System.out);
            System.exit(1);
            return;
        }

        agent.setParametersToDefaultValues();

        try {
            engine.start(agent);
        } catch (Throwable ex) {
            ex.printStackTrace(System.out);
            failedSteps.add("startEngine");
        }

        PathmindHelper helper = agent.pathmindHelper;

        try {
            System.out.println("observations:" + helper.observationForTraining().length);
            System.out.println("observationsNames:" + display(helper.getObservationNames()));
        } catch (Throwable ex) {
             System.out.println("Cannot get obs:");
             ex.printStackTrace(System.out);
             failedSteps.add("observations");
             System.out.println("observations:" + 0);
             System.out.println("observationsNames:");
        }

        // actions is here just to keep backward compatibility. When we remove support from webapp, we can remove it.
        System.out.println("actions:" + helper.getPossibleActionCount());
        System.out.println("rewardVariablesCount:" + helper.observationForReward().length);
        System.out.println("rewardVariables:" + display(helper.getRewardVariableNames()));

        try {
            if (!helper.isEnabled) {
                failedSteps.add("pathmindHelperDisabled");
            }
        } catch (Throwable ex) {
            System.out.println("Cannot get isEnabled:");
            ex.printStackTrace(System.out);
            failedSteps.add("pathmindHelperDisabled");
        }

        System.out.println("reward: not defined");
        System.out.println("failedSteps:" + String.join(",", failedSteps));

        System.exit(0);
    }
}
